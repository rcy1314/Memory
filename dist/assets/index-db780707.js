var U=(N,f,n)=>new Promise((d,h)=>{var p=s=>{try{y(n.next(s))}catch(u){h(u)}},c=s=>{try{y(n.throw(s))}catch(u){h(u)}},y=s=>s.done?d(s.value):Promise.resolve(s.value).then(p,c);y((n=n.apply(N,f)).next())});import{_ as B,N as V,a as g}from"./CommonPage-7e5436b1.js";import{u as A,_ as L,N as O,c as j,d as E}from"./useCRUD-8a16f100.js";import{_ as H}from"./TheIcon-a5071d78.js";import{r as v,ai as M,ay as b,o as Q,P as D,Q as z,R as o,a7 as _,U as e,aH as k,$ as i,X,Y,aw as G,h as m,dk as J}from"./index-be94632c.js";import{a as w}from"./icon-08752ca2.js";import{N as K}from"./InputNumber-99faf15f.js";import{N as C}from"./Input-147bc994.js";import"./format-length-c9d165c6.js";import"./use-locale-5356ed31.js";import"./AppPage-98713723.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./Popover-77560cbc.js";import"./Tag-ec2fced6.js";import"./Select-9a1b043a.js";import"./Space-5c805b1f.js";import"./ArrowDown-4efcc911.js";import"./Dropdown-8c0bb244.js";import"./Tooltip-ed686319.js";import"./Add-28a2437a.js";const be=Object.assign({name:"分类管理"},{__name:"index",setup(N){const f=v(null),n=v({}),d=M("permission"),h=v(!1),p={order:1},{modalVisible:c,modalTitle:y,modalLoading:s,handleAdd:u,handleDelete:I,handleEdit:S,handleSave:q,modalForm:r,modalFormRef:F}=A({name:"分类",initForm:p,doCreate:b.createCategory,doDelete:b.deleteCategory,doUpdate:b.updateCategory,refresh:()=>{var t;return(t=f.value)==null?void 0:t.handleSearch()}});Q(()=>{var t;(t=f.value)==null||t.handleSearch(),x()});const R=v(!1),$=v([]),T=[{title:"ID",key:"id",width:50,ellipsis:{tooltip:!0}},{title:"分类名称",key:"name",width:80,ellipsis:{tooltip:!0}},{title:"分类别名",key:"alias",width:80,ellipsis:{tooltip:!0}},{title:"分类描述",key:"desc",width:80,ellipsis:{tooltip:!0}},{title:"排序",key:"order",width:30,ellipsis:{tooltip:!0}},{title:"创建日期",key:"created_at",width:70,render(t){return m("span",J(t.created_at))}},{title:"操作",key:"actions",width:80,align:"center",fixed:"right",render(t){return[_(m(k,{size:"tiny",type:"primary",style:`display: ${t.children?"":"none"};margin-left:5px;`,onClick:()=>{p.parent_id=t.id,u()}},{default:()=>"子分类",icon:w("material-symbols:add",{size:16})}),[[d,"post/api/v1/category/create"]]),_(m(k,{size:"tiny",type:"info",style:"margin-left:5px;",onClick:()=>{R.value=!1,S(t)}},{default:()=>"编辑",icon:w("material-symbols:edit-outline",{size:16})}),[[d,"post/api/v1/category/update"]]),m(E,{onPositiveClick:()=>I({id:t.id},!1)},{trigger:()=>_(m(k,{size:"tiny",type:"error",style:`display: ${t.children&&t.children.length>0?"none":""};margin-left:5px;`},{default:()=>"删除",icon:w("material-symbols:delete-outline",{size:16})}),[[d,"delete/api/v1/category/delete"]]),default:()=>m("div",{},"确定删除该分类吗?")})]}}];function P(){p.parent_id=0,p.order=1,u()}function x(){return U(this,null,function*(){const{data:t}=yield b.getCategories(),a={id:0,name:"根目录",children:[]};a.children=t,$.value=[a]})}return(t,a)=>(D(),z(B,{"show-footer":"",title:t.$t("views.content.label_category_list")},{action:o(()=>[_((D(),z(e(k),{type:"primary",onClick:P},{default:o(()=>[i(H,{icon:"material-symbols:add",size:18,class:"mr-5"}),X(Y(t.$t("views.content.label_new_root_category")),1)]),_:1})),[[e(d),"post/api/v1/category/create"]])]),default:o(()=>[i(L,{ref_key:"$table",ref:f,"query-items":n.value,"onUpdate:queryItems":a[0]||(a[0]=l=>n.value=l),"is-pagination":!0,columns:T,"get-data":e(b).getCategories},null,8,["query-items","get-data"]),i(j,{visible:e(c),"onUpdate:visible":a[6]||(a[6]=l=>G(c)?c.value=l:null),title:e(y),loading:e(s),onSave:a[7]||(a[7]=l=>e(q)(x))},{default:o(()=>[i(e(V),{ref_key:"modalFormRef",ref:F,"label-placement":"top","label-align":"left","label-width":80,model:e(r)},{default:o(()=>[i(e(g),{label:"父级分类",path:"parent_id"},{default:o(()=>[i(e(O),{value:e(r).parent_id,"onUpdate:value":a[1]||(a[1]=l=>e(r).parent_id=l),"key-field":"id","label-field":"name",options:$.value,"default-expand-all":"",disabled:h.value},null,8,["value","options","disabled"])]),_:1}),i(e(g),{label:"分类名称",path:"name",rule:{required:!0,message:"请输入分类名称",trigger:["input","blur"]}},{default:o(()=>[i(e(C),{value:e(r).name,"onUpdate:value":a[2]||(a[2]=l=>e(r).name=l),placeholder:"请输入分类名称，不能与现有分类名称重复",maxlength:"30","show-count":"",clearable:""},null,8,["value"])]),_:1}),i(e(g),{label:"分类别名",path:"alias",rule:{required:!0,message:"请输入分类别名",trigger:["input","blur"]}},{default:o(()=>[i(e(C),{value:e(r).alias,"onUpdate:value":a[3]||(a[3]=l=>e(r).alias=l),placeholder:"请输入分类别名，用于生成分类URL，不能与现有分类别名重复",maxlength:"50","show-count":"",clearable:""},null,8,["value"])]),_:1}),i(e(g),{label:"分类描述",path:"desc"},{default:o(()=>[i(e(C),{value:e(r).desc,"onUpdate:value":a[4]||(a[4]=l=>e(r).desc=l),type:"textarea",placeholder:"请输入分类描述"},null,8,["value"])]),_:1}),i(e(g),{label:"显示排序",path:"order"},{default:o(()=>[i(e(K),{value:e(r).order,"onUpdate:value":a[5]||(a[5]=l=>e(r).order=l),min:1},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title","loading"])]),_:1},8,["title"]))}});export{be as default};
