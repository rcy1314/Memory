var j=Object.defineProperty;var D=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable;var I=(e,o,t)=>o in e?j(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t,c=(e,o)=>{for(var t in o||(o={}))Q.call(o,t)&&I(e,t,o[t]);if(D)for(var t of D(o))A.call(o,t)&&I(e,t,o[t]);return e};var k=(e,o,t)=>new Promise((u,n)=>{var i=l=>{try{s(t.next(l))}catch(r){n(r)}},a=l=>{try{s(t.throw(l))}catch(r){n(r)}},s=l=>l.done?u(l.value):Promise.resolve(l.value).then(i,a);s((t=t.apply(e,o)).next())});import{j as P,P as R,Q as B,bu as E,R as v,_ as T,an as _,a0 as w,aH as z,X as q,al as O,ax as U,W as $,d4 as K,T as F,r as b,ap as X,af as M,F as W,ac as H,d1 as L}from"./index-ON-SflwH.js";import{N as G}from"./Space-BWY59FNQ.js";import{N as J}from"./DataTable-q6oiHZgG.js";const Y={flex:"","justify-end":""},re={__name:"CrudModal",props:{width:{type:String,default:"600px"},title:{type:String,default:""},showFooter:{type:Boolean,default:!0},visible:{type:Boolean,required:!0},loading:{type:Boolean,default:!1}},emits:["update:visible","onSave"],setup(e,{emit:o}){const t=e,u=o,n=P({get(){return t.visible},set(i){u("update:visible",i)}});return(i,a)=>{const s=z,l=K;return B(),R(l,{show:$(n),"onUpdate:show":a[2]||(a[2]=r=>U(n)?n.value=r:null),style:O({width:e.width}),preset:"card",title:e.title,size:"huge",bordered:!1,"mask-closable":!1},E({default:v(()=>[_(i.$slots,"default")]),_:2},[e.showFooter?{name:"footer",fn:v(()=>[T("footer",Y,[_(i.$slots,"footer",{},()=>[w(s,{onClick:a[0]||(a[0]=r=>n.value=!1)},{default:v(()=>a[3]||(a[3]=[q("取消")])),_:1}),w(s,{loading:e.loading,"ml-20":"",type:"primary",onClick:a[1]||(a[1]=r=>u("save"))},{default:v(()=>a[4]||(a[4]=[q("保存")])),_:1},8,["loading"])])])]),key:"0"}:void 0]),1032,["show","style","title"])}}},Z={bg:"#fafafc","min-h-60":"",flex:"","items-start":"","justify-between":"","b-1":"","rounded-8":"","p-15":"","bc-ccc":"","dark:bg-black":""},ee={__name:"QueryBar",emits:["search","reset"],setup(e,{emit:o}){const t=o;return(u,n)=>{const i=z,a=G;return B(),F("div",Z,[w(a,{wrap:"",size:[35,15]},{default:v(()=>[_(u.$slots,"default"),T("div",null,[w(i,{secondary:"",type:"primary",onClick:n[0]||(n[0]=s=>t("reset"))},{default:v(()=>n[2]||(n[2]=[q("重置")])),_:1}),w(i,{"ml-20":"",type:"primary",onClick:n[1]||(n[1]=s=>t("search"))},{default:v(()=>n[3]||(n[3]=[q("搜索")])),_:1})])]),_:3})])}}},ue={__name:"CrudTable",props:{remote:{type:Boolean,default:!0},isPagination:{type:Boolean,default:!0},scrollX:{type:Number,default:450},rowKey:{type:String,default:"id"},columns:{type:Array,required:!0},queryItems:{type:Object,default(){return{}}},extraParams:{type:Object,default(){return{}}},getData:{type:Function,required:!0}},emits:["update:queryItems","onChecked","onDataChange"],setup(e,{expose:o,emit:t}){const u=e,n=t,i=b(!1),a=c({},u.queryItems),s=b([]),l=X({page:1,page_size:10});function r(){return k(this,null,function*(){try{i.value=!0;let d={};u.isPagination&&u.remote&&(d={page:l.page,page_size:l.page_size});const{data:y,total:C}=yield u.getData(c(c(c({},u.queryItems),u.extraParams),d));s.value=y,l.itemCount=C}catch(d){s.value=[],l.itemCount=0}finally{n("onDataChange",s.value),i.value=!1}})}function h(){l.page=1,r()}function f(){return k(this,null,function*(){const d=c({},u.queryItems);for(const y in d)d[y]="";n("update:queryItems",c(c({},d),a)),yield H(),l.page=1,r()})}function N(d){l.page=d,u.remote&&r()}function S(d){u.columns.some(y=>y.type==="selection")&&n("onChecked",d)}return o({handleSearch:h,handleReset:f}),(d,y)=>{const C=ee,m=J;return B(),F(W,null,[d.$slots.queryBar?(B(),R(C,{key:0,"mb-30":"",onSearch:h,onReset:f},{default:v(()=>[_(d.$slots,"queryBar")]),_:3})):M("",!0),w(m,{remote:e.remote,loading:$(i),columns:e.columns,"single-line":!1,striped:!0,data:$(s),"scroll-x":e.scrollX,"row-key":g=>g[e.rowKey],pagination:e.isPagination?$(l):!1,"onUpdate:checkedRowKeys":S,"onUpdate:page":N},null,8,["remote","loading","columns","data","scroll-x","row-key","pagination"])],64)}}},te={view:"查看",edit:"编辑",add:"新增"};function ie({name:e,initForm:o={},doCreate:t,doDelete:u,doUpdate:n,refresh:i}){const a=b(!1),s=b(""),l=P(()=>te[s.value]+e),r=b(!1),h=b(null),f=b(c({},o));function N(){s.value="add",a.value=!0,f.value=c({},o)}function S(m){s.value="edit",a.value=!0,f.value=c({},m)}function d(m){s.value="view",a.value=!0,f.value=c({},m)}function y(...m){var g;if(!["edit","add"].includes(s.value)){a.value=!1;return}(g=h.value)==null||g.validate(V=>k(this,null,function*(){if(V)return;const x={add:{api:()=>t(f.value),cb:()=>{m.forEach(p=>p&&p())},msg:()=>$message.success("添加成功")},edit:{api:()=>n(f.value),cb:()=>{m.forEach(p=>p&&p())},msg:()=>$message.success("编辑成功")}}[s.value];try{r.value=!0;const p=yield x.api();x.cb(),x.msg(),r.value=a.value=!1,p&&i(p)}catch(p){r.value=!1}}))}function C(){return k(this,arguments,function*(m={}){if(!L(m))try{r.value=!0;const g=yield u(m);$message.success("删除成功"),r.value=!1,i(g)}catch(g){r.value=!1}})}return{modalVisible:a,modalAction:s,modalTitle:l,modalLoading:r,handleAdd:N,handleDelete:C,handleEdit:S,handleView:d,handleSave:y,modalForm:f,modalFormRef:h}}export{ue as _,re as a,ie as u};
