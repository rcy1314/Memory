var U=(w,f,n)=>new Promise((d,h)=>{var p=s=>{try{y(n.next(s))}catch(m){h(m)}},c=s=>{try{y(n.throw(s))}catch(m){h(m)}},y=s=>s.done?d(s.value):Promise.resolve(s.value).then(p,c);y((n=n.apply(w,f)).next())});import{_ as B}from"./CommonPage-D3urqxip.js";import{u as V,_ as A,a as L}from"./useCRUD-ClolKu7P.js";import{_ as O}from"./TheIcon-BXCiGXN0.js";import{r as g,az as v,o as j,P as D,R as o,ak as E,Q as z,a0 as i,W as e,ax as H,a8 as _,aH as k,X as M,Z as Q,h as u,d5 as W}from"./index-CWFJs7gC.js";import{a as C}from"./icon-D4Vralp1.js";import{N as X}from"./InputNumber-6iUCKsyE.js";import{N as Z,a as b}from"./FormItem-C8gpvBZ1.js";import{N as G}from"./TreeSelect-Cz2AjnF_.js";import{N}from"./Input-lGLiS13x.js";import{N as J}from"./Popconfirm-Dxm7x2Xm.js";import"./AppPage-Dsgp7csD.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Space-clXW8pBo.js";import"./DataTable-BubEC4mQ.js";import"./format-length-B-p6aW7q.js";import"./RadioGroup-r_qFLbQY.js";import"./use-locale-EYmsExNA.js";import"./Tooltip-50tU-hD1.js";import"./Popover-R3LBGIk-.js";import"./Dropdown-CII12cf6.js";import"./Icon-Dic7jx24.js";import"./Tag-YM-0hAL5.js";import"./use-keyboard--YTx9NQL.js";import"./ArrowDown-DhMRZpYM.js";import"./utils-BPD5gl3K.js";import"./Select-CWsEZEJN.js";import"./Add-BF1x3bEh.js";const $e=Object.assign({name:"分类管理"},{__name:"index",setup(w){const f=g(null),n=g({}),d=E("permission"),h=g(!1),p={order:1},{modalVisible:c,modalTitle:y,modalLoading:s,handleAdd:m,handleDelete:I,handleEdit:S,handleSave:q,modalForm:r,modalFormRef:F}=V({name:"分类",initForm:p,doCreate:v.createCategory,doDelete:v.deleteCategory,doUpdate:v.updateCategory,refresh:()=>{var t;return(t=f.value)==null?void 0:t.handleSearch()}});j(()=>{var t;(t=f.value)==null||t.handleSearch(),$()});const R=g(!1),x=g([]),T=[{title:"ID",key:"id",width:50,ellipsis:{tooltip:!0}},{title:"分类名称",key:"name",width:80,ellipsis:{tooltip:!0}},{title:"分类别名",key:"alias",width:80,ellipsis:{tooltip:!0}},{title:"分类描述",key:"desc",width:80,ellipsis:{tooltip:!0}},{title:"排序",key:"order",width:30,ellipsis:{tooltip:!0}},{title:"创建日期",key:"created_at",width:70,render(t){return u("span",W(t.created_at))}},{title:"操作",key:"actions",width:80,align:"center",fixed:"right",render(t){return[_(u(k,{size:"tiny",type:"primary",style:`display: ${t.children?"":"none"};margin-left:5px;`,onClick:()=>{p.parent_id=t.id,m()}},{default:()=>"子分类",icon:C("material-symbols:add",{size:16})}),[[d,"post/api/v1/category/create"]]),_(u(k,{size:"tiny",type:"info",style:"margin-left:5px;",onClick:()=>{R.value=!1,S(t)}},{default:()=>"编辑",icon:C("material-symbols:edit-outline",{size:16})}),[[d,"post/api/v1/category/update"]]),u(J,{onPositiveClick:()=>I({id:t.id},!1)},{trigger:()=>_(u(k,{size:"tiny",type:"error",style:`display: ${t.children&&t.children.length>0?"none":""};margin-left:5px;`},{default:()=>"删除",icon:C("material-symbols:delete-outline",{size:16})}),[[d,"delete/api/v1/category/delete"]]),default:()=>u("div",{},"确定删除该分类吗?")})]}}];function P(){p.parent_id=0,p.order=1,m()}function $(){return U(this,null,function*(){const{data:t}=yield v.getCategories(),a={id:0,name:"根目录",children:[]};a.children=t,x.value=[a]})}return(t,a)=>(z(),D(B,{"show-footer":"",title:t.$t("views.content.label_category_list")},{action:o(()=>[_((z(),D(e(k),{type:"primary",onClick:P},{default:o(()=>[i(O,{icon:"material-symbols:add",size:18,class:"mr-5"}),M(Q(t.$t("views.content.label_new_root_category")),1)]),_:1})),[[e(d),"post/api/v1/category/create"]])]),default:o(()=>[i(A,{ref_key:"$table",ref:f,"query-items":n.value,"onUpdate:queryItems":a[0]||(a[0]=l=>n.value=l),"is-pagination":!0,columns:T,"get-data":e(v).getCategories},null,8,["query-items","get-data"]),i(L,{visible:e(c),"onUpdate:visible":a[6]||(a[6]=l=>H(c)?c.value=l:null),title:e(y),loading:e(s),onSave:a[7]||(a[7]=l=>e(q)($))},{default:o(()=>[i(e(Z),{ref_key:"modalFormRef",ref:F,"label-placement":"top","label-align":"left","label-width":80,model:e(r)},{default:o(()=>[i(e(b),{label:"父级分类",path:"parent_id"},{default:o(()=>[i(e(G),{value:e(r).parent_id,"onUpdate:value":a[1]||(a[1]=l=>e(r).parent_id=l),"key-field":"id","label-field":"name",options:x.value,"default-expand-all":"",disabled:h.value},null,8,["value","options","disabled"])]),_:1}),i(e(b),{label:"分类名称",path:"name",rule:{required:!0,message:"请输入分类名称",trigger:["input","blur"]}},{default:o(()=>[i(e(N),{value:e(r).name,"onUpdate:value":a[2]||(a[2]=l=>e(r).name=l),placeholder:"请输入分类名称，不能与现有分类名称重复",maxlength:"30","show-count":"",clearable:""},null,8,["value"])]),_:1}),i(e(b),{label:"分类别名",path:"alias",rule:{required:!0,message:"请输入分类别名",trigger:["input","blur"]}},{default:o(()=>[i(e(N),{value:e(r).alias,"onUpdate:value":a[3]||(a[3]=l=>e(r).alias=l),placeholder:"请输入分类别名，用于生成分类URL，不能与现有分类别名重复",maxlength:"50","show-count":"",clearable:""},null,8,["value"])]),_:1}),i(e(b),{label:"分类描述",path:"desc"},{default:o(()=>[i(e(N),{value:e(r).desc,"onUpdate:value":a[4]||(a[4]=l=>e(r).desc=l),type:"textarea",placeholder:"请输入分类描述"},null,8,["value"])]),_:1}),i(e(b),{label:"显示排序",path:"order"},{default:o(()=>[i(e(X),{value:e(r).order,"onUpdate:value":a[5]||(a[5]=l=>e(r).order=l),min:1},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title","loading"])]),_:1},8,["title"]))}});export{$e as default};
