var W=Object.defineProperty,X=Object.defineProperties;var Z=Object.getOwnPropertyDescriptors;var D=Object.getOwnPropertySymbols;var j=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var A=(i,s,a)=>s in i?W(i,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[s]=a,z=(i,s)=>{for(var a in s||(s={}))j.call(s,a)&&A(i,a,s[a]);if(D)for(var a of D(s))G.call(s,a)&&A(i,a,s[a]);return i},S=(i,s)=>X(i,Z(s));var f=(i,s,a)=>new Promise((b,x)=>{var w=d=>{try{c(a.next(d))}catch(_){x(_)}},m=d=>{try{c(a.throw(d))}catch(_){x(_)}},c=d=>d.done?b(d.value):Promise.resolve(d.value).then(w,m);c((a=a.apply(i,s)).next())});import{a1 as J,d8 as K,e0 as L,r as T,o as Y,P as I,R as r,az as y,Q as U,_ as N,a0 as n,W as o,aH as k,X as g,aI as ee,d4 as te,af as ae,Z as re,h as p,aB as C}from"./index-ON-SflwH.js";import{_ as oe}from"./CommonPage-Dj5qqsUj.js";import{_ as ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{N as se}from"./DataTable-q6oiHZgG.js";import{N as le,a as h}from"./FormItem-CFjxQbHB.js";import{N as B}from"./Input-Ck59uIzx.js";import{N as M}from"./Switch-D3pB72jH.js";import{N as ie}from"./DatePicker-D6CyvbCr.js";import{N as ue}from"./Space-BWY59FNQ.js";import{N as de}from"./Tag-U0zSNQTP.js";import{N as pe}from"./Popconfirm-JQzYnrhl.js";import"./AppPage-wwO3nDER.js";import"./format-length-B-p6aW7q.js";import"./RadioGroup-SzdPECF9.js";import"./use-locale-gdUNdwpT.js";import"./Tooltip-Bg3keV3f.js";import"./Popover-DLxopjSP.js";import"./Dropdown-xqSQiCI2.js";import"./Icon-BJkIY_JM.js";import"./use-keyboard-DJNqtv65.js";import"./ArrowDown-CbBleTM8.js";import"./utils-C8CieVbz.js";import"./Select-BuVN_q0M.js";const me={class:"m-30"},ce={class:"mb-4 flex gap-3"},fe={__name:"index",setup(i){const{t:s}=J(),a=K(),b=L(),x=T([]),w=T(!1),m=T(!1),c=T("create"),d=T(null),_=T(null),l=T({name:"",is_permanent:!0,expires_at:null,remark:""}),P={name:{required:!0,message:"请输入Token名称",trigger:["input","blur"]}},V=[{title:"Token名称",key:"name",width:150},{title:"Token值",key:"token",width:200,render(e){const t=e.token.substring(0,8)+"..."+e.token.substring(e.token.length-8);return p("div",{class:"flex items-center gap-2"},[p("span",{class:"font-mono overflow-x-auto whitespace-nowrap max-w-full"},t),p(k,{size:"small",type:"primary",ghost:!0,onClick:()=>Q(e.token)},{default:()=>"复制"})])}},{title:"类型",key:"is_permanent",width:100,render(e){return p(de,{type:e.is_permanent?"success":"warning",size:"small"},{default:()=>e.is_permanent?"永久":"临时"})}},{title:"过期时间",key:"expires_at",width:180,render(e){return e.is_permanent?"永不过期":e.expires_at?C(e.expires_at):"-"}},{title:"状态",key:"is_active",width:100,render(e){return p(M,{value:e.is_active,onUpdateValue:()=>E(e)})}},{title:"最后使用",key:"last_used",width:180,render(e){return e.last_used?C(e.last_used):"从未使用"}},{title:"创建时间",key:"created_at",width:180,render(e){return C(e.created_at)}},{title:"操作",key:"actions",width:200,render(e){return p("div",{class:"flex gap-2"},[p(k,{size:"small",type:"primary",ghost:!0,onClick:()=>F(e)},{default:()=>"编辑"}),p(k,{size:"small",type:"warning",ghost:!0,onClick:()=>q(e)},{default:()=>"重新生成"}),p(pe,{onPositiveClick:()=>H(e)},{default:()=>"确定删除这个Token吗？",trigger:()=>p(k,{size:"small",type:"error",ghost:!0},{default:()=>"删除"})})])}}];function v(){return f(this,null,function*(){try{w.value=!0;const e=yield y.getApiTokens();e.code===200&&(x.value=e.data||[])}catch(e){a.error("获取Token列表失败"),console.error(e)}finally{w.value=!1}})}function R(){c.value="create",l.value={name:"",is_permanent:!0,expires_at:null,remark:""},m.value=!0}function F(e){c.value="edit",d.value=e,l.value={name:e.name,is_permanent:e.is_permanent,expires_at:e.expires_at?new Date(e.expires_at).getTime():null,remark:e.remark||""},m.value=!0}function $(){return f(this,null,function*(){var e;try{yield(e=_.value)==null?void 0:e.validate();const t=S(z({},l.value),{expires_at:l.value.expires_at?new Date(l.value.expires_at).toISOString():null});c.value==="create"?(yield y.createApiToken(t)).code===200&&(a.success("Token创建成功"),m.value=!1,yield v()):(yield y.updateApiToken(d.value.id,t)).code===200&&(a.success("Token更新成功"),m.value=!1,yield v())}catch(t){console.error(t)}})}function q(e){return f(this,null,function*(){b.warning({title:"重新生成Token",content:"重新生成后，旧的Token将失效，确定继续吗？",positiveText:"确定",negativeText:"取消",onPositiveClick:()=>f(this,null,function*(){try{(yield y.regenerateApiToken(e.id)).code===200&&(a.success("Token重新生成成功"),yield v())}catch(t){a.error("Token重新生成失败"),console.error(t)}})})})}function E(e){return f(this,null,function*(){try{const t=yield y.toggleApiToken(e.id);t.code===200&&(a.success(t.msg||"Token状态更新成功"),yield v())}catch(t){a.error("Token状态更新失败"),console.error(t)}})}function H(e){return f(this,null,function*(){try{(yield y.deleteApiToken(e.id)).code===200&&(a.success("Token删除成功"),yield v())}catch(t){a.error("Token删除失败"),console.error(t)}})}function O(){return f(this,null,function*(){try{(yield y.createDefaultApiToken()).code===200&&(a.success("默认Token创建成功"),yield v())}catch(e){a.error("默认Token创建失败"),console.error(e)}})}function Q(e){navigator.clipboard.writeText(e).then(()=>{a.success("Token已复制到剪贴板")}).catch(()=>{const t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),a.success("Token已复制到剪贴板")})}return Y(()=>{v()}),(e,t)=>(U(),I(oe,{title:"Token设置"},{default:r(()=>[N("div",me,[N("div",ce,[n(o(k),{type:"primary",onClick:R},{icon:r(()=>t[6]||(t[6]=[N("i",{class:"i-mdi:plus"},null,-1)])),default:r(()=>[t[7]||(t[7]=g(" 新建Token "))]),_:1}),n(o(k),{type:"info",onClick:O},{icon:r(()=>t[8]||(t[8]=[N("i",{class:"i-mdi:key-plus"},null,-1)])),default:r(()=>[t[9]||(t[9]=g(" 创建默认Token "))]),_:1})]),n(o(ee),null,{default:r(()=>[n(o(se),{columns:V,data:x.value,loading:w.value,pagination:!1,bordered:!1,size:"small"},null,8,["data","loading"])]),_:1}),n(o(te),{show:m.value,"onUpdate:show":t[5]||(t[5]=u=>m.value=u),preset:"dialog",title:c.value==="create"?"新建Token":"编辑Token"},{action:r(()=>[n(o(ue),null,{default:r(()=>[n(o(k),{onClick:t[4]||(t[4]=u=>m.value=!1)},{default:r(()=>t[12]||(t[12]=[g("取消")])),_:1}),n(o(k),{type:"primary",onClick:$},{default:r(()=>[g(re(c.value==="create"?"创建":"更新"),1)]),_:1})]),_:1})]),default:r(()=>[n(o(le),{ref_key:"formRef",ref:_,model:l.value,rules:P,"label-placement":"top"},{default:r(()=>[n(o(h),{label:"Token名称",path:"name"},{default:r(()=>[n(o(B),{value:l.value.name,"onUpdate:value":t[0]||(t[0]=u=>l.value.name=u),placeholder:"请输入Token名称"},null,8,["value"])]),_:1}),n(o(h),{label:"Token类型"},{default:r(()=>[n(o(M),{value:l.value.is_permanent,"onUpdate:value":t[1]||(t[1]=u=>l.value.is_permanent=u)},{checked:r(()=>t[10]||(t[10]=[g("永久有效")])),unchecked:r(()=>t[11]||(t[11]=[g("临时Token")])),_:1},8,["value"])]),_:1}),l.value.is_permanent?ae("",!0):(U(),I(o(h),{key:0,label:"过期时间",path:"expires_at"},{default:r(()=>[n(o(ie),{value:l.value.expires_at,"onUpdate:value":t[2]||(t[2]=u=>l.value.expires_at=u),type:"datetime",placeholder:"请选择过期时间",style:{width:"100%"}},null,8,["value"])]),_:1})),n(o(h),{label:"备注"},{default:r(()=>[n(o(B),{value:l.value.remark,"onUpdate:value":t[3]||(t[3]=u=>l.value.remark=u),type:"textarea",placeholder:"请输入备注信息（可选）",rows:3},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])])]),_:1}))}},$e=ne(fe,[["__scopeId","data-v-d4dea2c5"]]);export{$e as default};
